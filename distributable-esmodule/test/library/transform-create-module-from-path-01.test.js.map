{"version":3,"sources":["../../../source/test/library/transform-create-module-from-path-01.test.js"],"names":["Browser","_Bundler","Path","Server","Test","Transform","Bundle","FilePath","_URL","fileURLToPath","import","meta","url","FolderPath","dirname","Require","_createRequire","test","sourcePath","targetPath","createModuleFromPath","relative","resolve","preIndexPath","postIndexPath","host","port","extname","start","browser","launch","page","newPage","goto","element","$$","item","Promise","all","map","evaluate","node","dataset","deepEqual","close","shutdown"],"mappings":"gFAAA,OAAOA,OAAP,MAAoB,WAApB;AACA,OAAOC,QAAP,MAAqB,SAArB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,MAAP,MAAmB,aAAnB;AACA,OAAOC,IAAP,MAAiB,KAAjB;;AAEA,SAASC,SAAT,QAA0B,gBAA1B;;AAEA,MAAM,EAAE,SAASC,MAAX,KAAsBL,QAA5B;AACA,MAAMM,QAAQ,GATdC,IAAI,CAACC,aAAL,CAAmBC,MAAM,CAACC,IAAP,CAAYC,GAA/B,CASA;AACA,MAAMC,UAAU,GAAGX,IAAI,CAACY,OAAL,CAAaP,QAAb,CAAnB;AACA,MAAMQ,OAAO,GAXbC,cAAc,CAACN,MAAM,CAACC,IAAP,CAAYC,GAAb,CAWd;;AAEAR,IAAI,CAAC,oEAAD,EAAuE,MAAOa,IAAP,IAAgB;;AAEzF,MAAIC,UAAU,GAAG,IAAjB;AACA,MAAIC,UAAU,GAAG,IAAjB;;AAEAD,EAAAA,UAAU,GAAI,GAAEL,UAAW,yBAA3B;AACAM,EAAAA,UAAU,GAAI,GAAEN,UAAW,wBAA3B;;AAEA,QAAMR,SAAS,CAACe,oBAAV,CAA+BF,UAA/B,EAA2CC,UAA3C,EAAuD,EAAE,WAAWjB,IAAI,CAACmB,QAAL,CAAcnB,IAAI,CAACY,OAAL,CAAaI,UAAb,CAAd,EAAwCH,OAAO,CAACO,OAAR,CAAgB,0BAAhB,CAAxC,CAAb,EAAvD,CAAN;;AAEA,MAAIC,YAAY,GAAI,GAAEV,UAAW,0BAAjC;AACA,MAAIW,aAAa,GAAI,GAAEX,UAAW,2BAAlC;;AAEA,QAAMP,MAAM,CAAC;AACX,mBAAe,CAAEiB,YAAF,CADJ;AAEX,eAAWC,aAFA;AAGX,cAAU,KAHC;AAIX,cAAU,IAJC,EAAD,CAAZ;;;AAOA,MAAIC,IAAI,GAAG,SAAX;AACA,MAAIC,IAAI,GAAGxB,IAAI,CAACyB,OAAL,CAAapB,QAAb,MAA2B,MAA3B,GAAoC,IAApC,GAA2C,IAAtD;;AAEAJ,EAAAA,MAAM,CAACyB,KAAP,CAAa;AACX,YAAQH,IADG;AAEX,YAAQC,IAFG;AAGX,gBAAY,CAHD;AAIX,aAAS;AACP,KAAE,GAAF,EAAQ,GAAEb,UAAW,MAArB,CADO;AAEP,KAAE,cAAF,EAAmB,GAAEA,UAAW,+BAAhC,CAFO,CAJE;;AAQX,YAAQ,KARG,EAAb;;;AAWA,MAAI;;AAEF,QAAIgB,OAAO,GAAG,MAAM7B,OAAO,CAAC8B,MAAR,EAApB;;AAEA,QAAI;;AAEF,UAAIC,IAAI,GAAG,MAAMF,OAAO,CAACG,OAAR,EAAjB;;AAEA;AACA;AACA;;AAEA,YAAMD,IAAI,CAACE,IAAL,CAAW,UAASR,IAAK,IAAGC,IAAK,aAAjC,CAAN;;AAEA,UAAIQ,OAAO,GAAG,MAAMH,IAAI,CAACI,EAAL,CAAQ,YAAR,CAApB;AACA,UAAIC,IAAI,GAAG,MAAMC,OAAO,CAACC,GAAR,CAAYJ,OAAO,CAACK,GAAR,CAAaL,OAAD,IAAaA,OAAO,CAACM,QAAR,CAAkBC,IAAD,IAAUA,IAAI,CAACC,OAAL,CAAaN,IAAxC,CAAzB,CAAZ,CAAjB;;AAEAnB,MAAAA,IAAI,CAAC0B,SAAL,CAAeP,IAAf,EAAqB,CAAE,GAAF,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,GAAzB,CAArB;;AAED,KAfD,SAeU;AACR,YAAMP,OAAO,CAACe,KAAR,EAAN;AACD;;AAEF,GAvBD,SAuBU;AACRzC,IAAAA,MAAM,CAAC0C,QAAP;AACD;;AAEF,CA7DG,CAAJ","sourcesContent":["import Browser from 'puppeteer'\nimport _Bundler from 'esbuild'\nimport Path from 'path'\nimport Server from 'live-server'\nimport Test from 'ava'\n\nimport { Transform } from '../../index.js'\n\nconst { 'build': Bundle } = _Bundler\nconst FilePath = __filePath\nconst FolderPath = Path.dirname(FilePath)\nconst Require = __require\n\nTest('createModuleFromPath(sourcePath, targetPath, option) using browser', async (test) => {\n  \n  let sourcePath = null\n  let targetPath = null\n\n  sourcePath = `${FolderPath}/www/script/element.pug`\n  targetPath = `${FolderPath}/www/script/element.js`\n\n  await Transform.createModuleFromPath(sourcePath, targetPath, { 'utility': Path.relative(Path.dirname(sourcePath), Require.resolve('../../library/utility.js')) })\n\n  let preIndexPath = `${FolderPath}/www/script/pre-index.js`\n  let postIndexPath = `${FolderPath}/www/script/post-index.js`\n\n  await Bundle({\n    'entryPoints': [ preIndexPath ],\n    'outfile': postIndexPath,\n    'minify': false,\n    'bundle': true\n  })\n  \n  let host = '0.0.0.0'\n  let port = Path.extname(FilePath) === '.cjs' ? 8080 : 8081\n\n  Server.start({\n    'host': host,\n    'port': port,\n    'logLevel': 0,\n    'mount': [\n      [ '/', `${FolderPath}/www` ],\n      [ '/favicon.ico', `${FolderPath}/www/resource/application.ico` ]\n    ],\n    'open': false\n  })\n\n  try {\n    \n    let browser = await Browser.launch()\n\n    try {\n    \n      let page = await browser.newPage()\n\n      // page.on('console', (message) => {\n      //   test.log(message.args()[0].toString())\n      // })\n\n      await page.goto(`http://${host}:${port}/index.html`)\n\n      let element = await page.$$('li.element')\n      let item = await Promise.all(element.map((element) => element.evaluate((node) => node.dataset.item)))\n\n      test.deepEqual(item, [ 'a', 'ab', 'bb', 'cb', 'c' ])\n      \n    } finally {\n      await browser.close()\n    }\n\n  } finally {\n    Server.shutdown()\n  }\n\n})\n"],"file":"transform-create-module-from-path-01.test.js"}